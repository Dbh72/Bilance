<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bilancia Numerica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        .font-inter {
            font-family: 'Inter', sans-serif
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(to bottom, #87ceeb, #add8e6, #f0f8ff);
        }

        .sky-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            pointer-events: none;
        }
        
        .cloud {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.8;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            animation: move-cloud linear infinite;
        }
        
        .cloud::before, .cloud::after {
            content: '';
            position: absolute;
            background: white;
            border-radius: 50%;
        }
        
        .cloud::before {
            width: 150%;
            height: 150%;
            top: -20%;
            left: -40%;
        }
        
        .cloud::after {
            width: 100%;
            height: 100%;
            top: 20%;
            left: 50%;
        }
        
        /* Responsive cloud sizes */
        .cloud-small {
            width: 100px;
            height: 40px;
        }
        .cloud-medium {
            width: 150px;
            height: 60px;
        }
        .cloud-large {
            width: 200px;
            height: 80px;
        }
        .cloud-xl {
            width: 250px;
            height: 100px;
        }
        
        @keyframes move-cloud {
            from { transform: translateX(-100vw); }
            to { transform: translateX(200vw); }
        }

        .min-h-screen {
            min-height: 100vh
        }
        .flex {
            display: flex
        }
        .flex-col {
            flex-direction: column
        }
        .items-center {
            align-items: center
        }
        .justify-center {
            justify-content: center
        }
        .p-4 {
            padding: 1rem
        }
        .bg-amber-50 {
            background-color: #fffbeb
        }
        .p-6 {
            padding: 1.5rem
        }
        .rounded-xl {
            border-radius: .75rem
        }
        .shadow-lg {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, .1), 0 4px 6px -2px rgba(0, 0, 0, .06)
        }
        .mb-6 {
            margin-bottom: 1.5rem
        }
        .w-full {
            width: 100%
        }
        .max-w-2xl {
            max-width: 42rem
        }
        .md\:flex-row {
            flex-direction: row
        }
        .gap-4 {
            gap: 1rem
        }
        .flex-1 {
            flex: 1 1 0%
        }
        .block {
            display: block
        }
        .text-lg {
            font-size: 1.125rem
        }
        .font-semibold {
            font-weight: 600
        }
        .text-gray-700 {
            color: #374151
        }
        .mb-2 {
            margin-bottom: .5rem
        }
        .p-2 {
            padding: .5rem
        }
        .border {
            border-width: 1px
        }
        .border-gray-300 {
            border-color: #d1d5db
        }
        .rounded-md {
            border-radius: .375rem
        }
        .focus\:ring-2:focus {
            --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);
            --tw-ring-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)
        }
        .focus\:ring-blue-400:focus {
            --tw-ring-color: #60a5fa
        }
        .bg-blue-600 {
            background-color: #2563eb
        }
        .hover\:bg-blue-700:hover {
            background-color: #1d4ed8
        }
        .text-white {
            color: #fff
        }
        .font-bold {
            font-weight: 700
        }
        .py-3 {
            padding-top: .75rem;
            padding-bottom: .75rem
        }
        .px-6 {
            padding-left: 1.5rem;
            padding-right: 1.5rem
        }
        .rounded-lg {
            border-radius: .5rem
        }
        .shadow-md {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, .1), 0 2px 4px -1px rgba(0, 0, 0, .06)
        }
        .transition {
            transition-property: background-color, border-color, color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;
            transition-timing-function: cubic-bezier(.4, 0, .2, 1);
            transition-duration: 150ms
        }
        .duration-300 {
            transition-duration: 300ms
        }
        .ease-in-out {
            transition-timing-function: cubic-bezier(.4, 0, .2, 1)
        }
        .transform {
            transform: var(--tw-transform)
        }
        .hover\:scale-105:hover {
            --tw-scale-x: 1.05;
            --tw-scale-y: 1.05;
            transform: var(--tw-transform)
        }
        .sm\:w-auto {
            width: auto
        }
        .bg-red-500 {
            background-color: #ef4444
        }
        .hover\:bg-red-600:hover {
            background-color: #dc2626
        }
        .text-red-600 {
            color: #dc2626
        }
        .mt-4 {
            margin-top: 1rem
        }
        .text-center {
            text-align: center
        }
        .bg-gray-50 {
            background-color: #f9fafb
        }
        .border-gray-200 {
            border-color: #e5e7eb
        }
        .mt-6 {
            margin-top: 1.5rem
        }
        .text-gray-800 {
            color: #1f2937
        }
        .relative {
            position: relative
        }
        .max-w-xl {
            max-width: 36rem
        }
        .mt-8 {
            margin-top: 2rem
        }
        .mb-12 {
            margin-bottom: 3rem
        }
        @keyframes tiltClockwise {
            0% { transform: rotate(0deg); }
            70% { transform: rotate(12deg); }
            100% { transform: rotate(10deg); }
        }
        @keyframes tiltCounterClockwise {
            0% { transform: rotate(0deg); }
            70% { transform: rotate(-12deg); }
            100% { transform: rotate(-10deg); }
        }
        .beam-tilt-clockwise {
            animation: tiltClockwise 1s ease-out forwards;
        }
        .beam-tilt-counter-clockwise {
            animation: tiltCounterClockwise 1s ease-out forwards;
        }
        .fixed {
            position: fixed
        }
        .inset-0 {
            top: 0;
            right: 0;
            bottom: 0;
            left: 0
        }
        .bg-gray-800 {
            background-color: #1f2937
        }
        .bg-opacity-75 {
            background-color: rgba(31, 41, 55, .75)
        }
        .z-50 {
            z-index: 50
        }
        .max-w-md {
            max-width: 28rem
        }
        .mx-auto {
            margin-left: auto;
            margin-right: auto
        }
        .text-xl {
            font-size: 1.25rem
        }
        .mb-3 {
            margin-bottom: .75rem
        }
        .gap-3 {
            gap: .75rem
        }
        .py-2 {
            padding-top: .5rem;
            padding-bottom: .5rem
        }
        .px-4 {
            padding-left: 1rem;
            padding-right: 1rem
        }
        .bg-gray-300 {
            background-color: #d1d5db
        }
        .hover\:bg-gray-400:hover {
            background-color: #9ca3af
        }
        .app-link-section {
            margin-top: 30px;
            padding: 20px;
            background-color: #FFFBEB;
            border-left: 5px solid #F59E0B;
            border-radius: 5px;
            text-align: center;
        }
        .app-link-section a {
            font-size: 1.2em;
            color: #B45309;
            text-decoration: none;
            font-weight: bold;
        }
        .app-link-section a:hover {
            text-decoration: underline;
            color: #9A3412;
        }
        .back-link-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #FEF3C7;
            border-left: 5px solid #FCD34D;
            border-radius: 5px;
            text-align: center;
        }
        .back-link-section a {
            font-size: 1.2em;
            color: #B45309;
            text-decoration: none;
            font-weight: bold;
        }
        .back-link-section a:hover {
            text-decoration: underline;
            color: #9A3412;
        }
        /* New CSS to fix the scaling issue */
        .scale-container {
            width: 100%;
            max-width: 42rem;
            flex-grow: 1; /* Allow the container to grow and fill space */
            min-height: 400px; /* Ensure a minimum height is always present */
        }
    </style>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>
    <div class="sky-container"></div>

    <script type="text/babel">
        // Greatest Common Denominator (GCD) using Euclidean algorithm
        const gcd = (a, b) => {
            a = Math.abs(a);
            b = Math.abs(b);
            while (b) {
                [a, b] = [b, a % b];
            }
            return a
        };

        // Simplify a fraction {numerator, denominator, sign}
        const simplifyFraction = f => {
            if (f.numerator === 0) {
                return {
                    numerator: 0,
                    denominator: 1,
                    sign: 1
                }
            }
            const c = gcd(f.numerator, f.denominator);
            return {
                numerator: f.numerator / c,
                denominator: f.denominator / c,
                sign: f.sign
            }
        };

        // Utility function to divide two fractions
        const divideFractions = (f1, f2) => {
            if (f2.numerator === 0) {
                return {
                    error: 'Divisione per zero.'
                }
            }
            const n1 = f1.numerator * f1.sign;
            const d1 = f1.denominator;
            const n2 = f2.numerator * f2.sign;
            const d2 = f2.denominator;
            const num = n1 * d2;
            const den = d1 * n2;
            let sign = 1;
            if (num < 0) {
                sign *= -1
            }
            if (den < 0) {
                sign *= -1
            }
            const s = simplifyFraction({
                numerator: Math.abs(num),
                denominator: Math.abs(den),
                sign: sign
            });
            return s
        };

        // Get display string for a fraction
        function getFractionalDisplayString(f) {
            if (!f || typeof f.numerator === 'undefined' || typeof f.denominator === 'undefined' || typeof f.sign === 'undefined') {
                return "INVALID_FRACTION"
            }
            if (f.numerator === 0) return "0";
            const s = f.sign === -1 ? "-" : "";
            return `${s}${f.numerator}${f.denominator === 1 ? '' : '/' + f.denominator}`
        }

        // Parse input string to fraction or number
        const parseFractionOrNumber = i => {
            let r = String(i).trim();
            let oS = 1; // Original Sign
            const oI = i.trim(); // Original Input
            if (r === '' || r === '(' || r === ')' || r === '[' || r === ']' || r === '}') {
                return {
                    error: `Formato numerico non valido: "${i}".`
                }
            }
            let hELS = false; // Has Explicit Leading Sign
            if (r.startsWith('-')) {
                oS = -1;
                r = r.substring(1).trim();
                hELS = true
            } else if (r.startsWith('+')) {
                r = r.substring(1).trim();
                hELS = true
            }
            let b = 0; // Balance for parentheses
            let tLS = []; // Trailing Slash Indices
            for (let k = 0; k < r.length; k++) {
                if (r[k] === '(') b++;
                else if (r[k] === ')') b--;
                else if (r[k] === '/' && b === 0) {
                    tLS.push(k)
                }
            }
            if (tLS.length > 1) {
                return {
                    error: `Formato frazionario ambiguo: "${i}". Utilizza le parentesi per chiarire (es. (1/2)/3 o 1/(2/3)).`
                }
            }
            let mSI = tLS.length === 1 ? tLS[0] : -1; // Main Slash Index
            let fFV; // Final Fractional Value
            let fNV; // Final Numeric Value
            if (mSI !== -1) {
                let nS = r.substring(0, mSI).trim(); // Numerator String
                let dS = r.substring(mSI + 1).trim(); // Denominator String
                let nP = parseFractionOrNumber(nS); // Numerator Parse
                if (nP.error) return {
                    error: nP.error
                };
                let dP = parseFractionOrNumber(dS); // Denominator Parse
                if (dP.error) return {
                    error: dP.error
                };
                if (dP.numericValue === 0) {
                    return {
                        error: 'Divisione per zero.'
                    }
                }
                const cF = divideFractions(nP.fractionalValue, dP.fractionalValue); // Combined Fraction
                if (cF.error) {
                    return {
                        error: cF.error
                    }
                }
                fFV = simplifyFraction(cF);
                fFV.sign *= oS;
                fNV = (fFV.numerator / fFV.denominator) * fFV.sign
            } else if (r.startsWith('(') && r.endsWith(')')) {
                let iC = r.slice(1, -1).trim(); // Inner Content
                if (iC === '') {
                    return {
                        error: `Contenuto vuoto all'interno delle parentesi: "${i}".`
                    }
                }
                const pI = parseFractionOrNumber(iC); // Parsed Inner
                if (pI.error) return {
                    error: pI.error
                };
                fFV = pI.fractionalValue;
                fFV.sign *= oS;
                fNV = (fFV.numerator / fFV.denominator) * fFV.sign
            } else {
                const sNR = /^(?:\d+(?:\.\d*)?|\.\d+)$/; // Simple Number Regex
                if (!r.match(sNR)) {
                    return {
                        error: `Formato numerico non valido: "${i}".`
                    }
                }
                const nV = parseFloat(r); // Numeric Value
                if (isNaN(nV)) {
                    return {
                        error: `Errore interno di parsing per "${i}".`
                    }
                }
                let n = nV; // Numerator
                let d = 1; // Denominator
                if (nV % 1 !== 0) {
                    const dP = (nV.toString().split('.')[1] || '').length; // Decimal Places
                    d = Math.pow(10, dP);
                    n = Math.round(nV * d)
                }
                fFV = simplifyFraction({
                    numerator: Math.abs(n),
                    denominator: d,
                    sign: (n < 0 ? -1 : 1)
                });
                fFV.sign *= oS;
                fNV = (fFV.numerator / fFV.denominator) * fFV.sign
            }
            let dS; // Display String
            if (fFV.denominator === 1) {
                dS = String(fFV.numerator * fFV.sign)
            } else {
                dS = getFractionalDisplayString(fFV)
            }
            if (fNV === 0 && Object.is(fNV, -0)) {
                dS = "0"
            }
            return {
                type: 'number',
                fractionalValue: fFV,
                numericValue: fNV,
                displayString: dS,
                originalInputString: i
            }
        };

        // Modal Component
        const Modal = ({
            isOpen,
            content,
            onConfirm,
            onCancel,
            inputRef
        }) => {
            if (!isOpen) return null;
            return (
                <div className={`fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 p-4`}>
                    <div className="bg-amber-50 rounded-xl shadow-2xl p-8 max-w-md w-full mx-auto">
                        <h3 className="text-xl font-bold text-gray-800 mb-3">{content.title}</h3>
                        <p className="text-gray-700 mb-4">{content.message}</p>
                        {content.inputNeeded && (
                            <input ref={inputRef} type="text" className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-400" defaultValue={content.initialValue} onKeyPress={e => {
                                if (e.key === 'Enter') onConfirm()
                            }} />
                        )}
                        <div className="flex flex-col gap-3 mt-4">
                            {content.showCancel && (
                                <button onClick={onCancel} className="py-2 px-4 rounded-md font-semibold transition-colors duration-200 w-full bg-gray-300 text-gray-800 hover:bg-gray-400">Annulla</button>
                            )}
                            <button onClick={onConfirm} className="py-2 px-4 rounded-md font-semibold transition-colors duration-200 w-full bg-blue-600 text-white hover:bg-blue-700">OK</button>
                        </div>
                    </div>
                </div>
            )
        };

        // Main App Component
        const App = () => {
            const [leftInput, setLeftInput] = React.useState('');
            const [rightInput, setRightInput] = React.useState('');
            const [resultText, setResultText] = React.useState('');
            const [balanceTilt, setBalanceTilt] = React.useState(0);
            const [leftPanYOffset, setLeftPanYOffset] = React.useState(0);
            const [rightPanYOffset, setRightPanYOffset] = React.useState(0);
            const [leftPanXOffset, setLeftPanXOffset] = React.useState(0);
            const [rightPanXOffset, setRightPanXOffset] = React.useState(0);
            const [error, setError] = React.useState(null);
            const [isModalOpen, setIsModalOpen] = React.useState(false);
            const [modalContent, setModalContent] = React.useState({
                type: '',
                title: '',
                message: '',
                inputNeeded: false,
                showCancel: false,
                initialValue: ''
            });
            const [modalResolve, setModalResolve] = React.useState(null);
            const modalInputRef = React.useRef(null);
            
            // Effect per la creazione delle nuvole dinamiche una volta montato il componente
            React.useEffect(() => {
                function createCloud() {
                    const container = document.querySelector('.sky-container');
                    if (!container) return;
                    const cloud = document.createElement('div');
                    cloud.className = 'cloud';
                    
                    const sizes = ['cloud-small', 'cloud-medium', 'cloud-large', 'cloud-xl'];
                    const randomSizeClass = sizes[Math.floor(Math.random() * sizes.length)];
                    cloud.classList.add(randomSizeClass);

                    cloud.style.top = `${Math.random() * 80}vh`;
                    
                    const randomDuration = Math.random() * 80 + 100;
                    cloud.style.animationDuration = `${randomDuration}s`;
                    
                    const randomDelay = Math.random() * -100;
                    cloud.style.animationDelay = `${randomDelay}s`;
                    
                    container.appendChild(cloud);
                }

                const numberOfClouds = 10;
                for (let i = 0; i < numberOfClouds; i++) {
                    createCloud();
                }
            }, []);

            // Function to show custom alert modal
            const showCustomAlert = async (m, t = "Avviso") => {
                return new Promise(r => {
                    setModalContent({
                        type: 'alert',
                        title: t,
                        message: m,
                        inputNeeded: false,
                        showCancel: false,
                        initialValue: ''
                    });
                    setModalResolve(() => r);
                    setIsModalOpen(true)
                })
            };

            // Handle modal confirmation
            const handleModalConfirm = () => {
                if (modalResolve) {
                    modalResolve(modalContent.inputNeeded ? modalInputRef.current.value : true)
                }
                setIsModalOpen(false)
            };

            // Handle modal cancellation
            const handleModalCancel = () => {
                if (modalResolve) {
                    modalResolve(null)
                }
                setIsModalOpen(false)
            };

            // Handle comparison logic
            const handleCompare = async () => {
                setError(null);
                setResultText('');
                setBalanceTilt(0);
                setLeftPanYOffset(0);
                setRightPanYOffset(0);
                setLeftPanXOffset(0);
                setRightPanXOffset(0);

                const pL = parseFractionOrNumber(leftInput);
                const pR = parseFractionOrNumber(rightInput);

                if (pL.error) {
                    setError(`Errore nel lato sinistro: ${pL.error}`);
                    await showCustomAlert(`Errore nel lato sinistro: ${pL.error}`);
                    return
                }
                if (pR.error) {
                    setError(`Errore nel lato destro: ${pR.error}`);
                    await showCustomAlert(`Errore nel lato destro: ${pR.error}`);
                    return
                }

                const lN = pL.numericValue;
                const rN = pR.numericValue;

                let cS = '';
                let tA = 0;
                let lY = 0;
                let rY = 0;
                let lX = 0;
                let rX = 0;

                const armLength = 100;
                const maxTiltAngle = 10;
                const fulcrumY = 100; // Updated fulcrum Y position
                const beam_pivot_x = 200;
                const beam_pivot_y = fulcrumY;

                if (lN > rN) {
                    cS = '>';
                    tA = -maxTiltAngle;
                } else if (rN > lN) {
                    cS = '<';
                    tA = maxTiltAngle;
                } else {
                    cS = '=';
                    tA = 0;
                }

                const current_angle_rad = tA * Math.PI / 180;
                const displacementY = armLength * Math.sin(Math.abs(tA) * Math.PI / 180);

                if (tA < 0) {
                    lY = displacementY;
                    rY = -displacementY;
                } else if (tA > 0) {
                    lY = -displacementY;
                    rY = displacementY;
                } else {
                    lY = 0;
                    rY = 0;
                }

                const beam_cord_attach_x_left1_unrotated = 60;
                const beam_cord_attach_x_right1_unrotated = 260;
                const beam_cord_attach_y_local = fulcrumY + 10;

                const rotatePoint = (x, y, px, py, angle_rad) => {
                    const cos = Math.cos(angle_rad);
                    const sin = Math.sin(angle_rad);
                    const dx = x - px;
                    const dy = y - py;
                    const rotatedX = dx * cos - dy * sin + px;
                    const rotatedY = dx * sin + dy * cos + py;
                    return { x: rotatedX, y: rotatedY };
                };

                const rotatedBeamAttachL1 = rotatePoint(beam_cord_attach_x_left1_unrotated, beam_cord_attach_y_local, beam_pivot_x, beam_pivot_y, current_angle_rad);
                const rotatedBeamAttachR1 = rotatePoint(beam_cord_attach_x_right1_unrotated, beam_cord_attach_y_local, beam_pivot_x, beam_pivot_y, current_angle_rad);

                lX = rotatedBeamAttachL1.x - (50 + 10);
                rX = rotatedBeamAttachR1.x - (250 + 10);

                setBalanceTilt(tA);
                setLeftPanYOffset(lY);
                setRightPanYOffset(rY);
                setLeftPanXOffset(lX);
                setRightPanXOffset(rX);

                const r = `${pL.displayString} ${cS} ${pR.displayString}<br/>Valori con Segno: ${pL.displayString} ${cS} ${pR.displayString}<br/>Valori Decimali: ${lN.toFixed(4)} ${cS} ${rN.toFixed(4)}`;
                setResultText(r)
            };

            const handleClear = () => {
                setLeftInput('');
                setRightInput('');
                setResultText('');
                setBalanceTilt(0);
                setLeftPanYOffset(0);
                setRightPanYOffset(0);
                setLeftPanXOffset(0);
                setRightPanXOffset(0);
                setError(null)
            };

            const fulcrumY = 100;
            const newPlateBaseY = 170; // Adjusted for new fulcrumY
            const rotatePoint = (x, y, px, py, angle_rad) => {
                const cos = Math.cos(angle_rad);
                const sin = Math.sin(angle_rad);
                const dx = x - px;
                const dy = y - py;
                const rotatedX = dx * cos - dy * sin + px;
                const rotatedY = dx * sin + dy * cos + py;
                return { x: rotatedX, y: rotatedY };
            };

            const beam_pivot_x = 200;
            const beam_pivot_y = fulcrumY;
            const angle_rad = balanceTilt * Math.PI / 180;

            const beam_cord_attach_x_left1_unrotated = 60;
            const beam_cord_attach_x_left2_unrotated = 140;
            const beam_cord_attach_x_right1_unrotated = 260;
            const beam_cord_attach_x_right2_unrotated = 340;
            const beam_cord_attach_y_local = fulcrumY + 10;

            const rotatedBeamAttachL1 = rotatePoint(beam_cord_attach_x_left1_unrotated, beam_cord_attach_y_local, beam_pivot_x, beam_pivot_y, angle_rad);
            const rotatedBeamAttachL2 = rotatePoint(beam_cord_attach_x_left2_unrotated, beam_cord_attach_y_local, beam_pivot_x, beam_pivot_y, angle_rad);
            const rotatedBeamAttachR1 = rotatePoint(beam_cord_attach_x_right1_unrotated, beam_cord_attach_y_local, beam_pivot_x, beam_pivot_y, angle_rad);
            const rotatedBeamAttachR2 = rotatePoint(beam_cord_attach_x_right2_unrotated, beam_cord_attach_y_local, beam_pivot_x, beam_pivot_y, angle_rad);

            return (
                <div className="min-h-screen flex flex-col items-center p-4 font-inter relative z-10">
                    <h1 className="text-4xl font-extrabold text-blue-800 mb-8 drop-shadow-md text-center">Bilancia Numerica</h1>
                    <div className="text-base text-gray-700 mb-6 text-center max-w-2xl">
                        <p className="mb-2">Questa bilancia didattica simula il comportamento di una bilancia fisica:</p>
                        <ul className="list-disc list-inside text-left mx-auto max-w-xl">
                            <li className="mb-1">il piatto con il valore numerico <b>maggiore</b> (più "pesante") <b>scende</b>;</li>
                            <li className="mb-1">il piatto con il valore numerico <b>minore</b> (più "leggero") <b>sale</b>;</li>
                            <li>se i valori sono <b>uguali</b>, la bilancia rimane in <b>perfetto equilibrio</b>.</li>
                        </ul>
                    </div>
                    <p className="text-lg text-emerald-700 mb-6 text-center max-w-2xl">Inserisci numeri, decimali o frazioni (es. 1/2, -5, (3/4)) in entrambi i lati della bilancia per confrontarli.</p>
                    <div className="bg-amber-50 p-6 rounded-xl shadow-lg mb-6 w-full max-w-2xl">
                        <div className="flex flex-col md:flex-row gap-4 mb-6">
                            <div className="flex-1">
                                <label htmlFor="left-input" className="block text-lg font-semibold text-blue-700 mb-2">Lato Sinistro:</label>
                                <input id="left-input" type="text" value={leftInput} onChange={e => setLeftInput(e.target.value)} placeholder="Es. 1/2, -5, (3/4)" className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-400" />
                            </div>
                            <div className="flex-1">
                                <label htmlFor="right-input" className="block text-lg font-semibold text-blue-700 mb-2">Lato Destro:</label>
                                <input id="right-input" type="text" value={rightInput} onChange={e => setRightInput(e.target.value)} placeholder="Es. 0.75, 1, -(2/3)" className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-400" />
                            </div>
                        </div>
                        <div className="flex flex-col sm:flex-row gap-4 justify-center">
                            <button onClick={handleCompare} className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 w-full sm:w-auto">Confronta</button>
                            <button onClick={handleClear} className="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 w-full sm:w-auto">Pulisci</button>
                        </div>
                        {error && (
                            <div className="text-red-600 font-bold mt-4 text-center">
                                <p>Errore: {error}</p>
                            </div>
                        )}
                        {resultText && (
                            <div className="bg-gray-50 p-4 rounded-md border border-gray-200 mt-6 text-center">
                                <p className="text-lg text-gray-800 font-semibold" dangerouslySetInnerHTML={{
                                    __html: resultText
                                }}></p>
                            </div>
                        )}
                    </div>
                    <div className="scale-container relative flex items-center justify-center mt-8 mb-12">
                        <svg viewBox="0 0 400 400" className="w-full h-full">
                            <defs>
                                <radialGradient id="plateGradient" cx="50%" cy="50%" r="50%" fx="50%" fy="50%">
                                    <stop offset="0%" stop-color="#DBEAFE" />
                                    <stop offset="100%" stop-color="#93C5FD" />
                                </radialGradient>
                                <filter id="plateShadow" x="-50%" y="-50%" width="200%" height="200%">
                                    <feDropShadow dx="2" dy="2" stdDeviation="3" flood-color="#000" flood-opacity="0.3"/>
                                </filter>
                            </defs>
                            {/* Base della bilancia */}
                            <rect x="150" y="350" width="100" height="20" fill="#F59E0B" rx="5" ry="5" />
                            {/* Braccio verticale */}
                            <polygon points={`170,350 200,${fulcrumY} 230,350`} fill="#FBBF24" />

                            {/* Asta della bilancia con rotazione */}
                            <g transform={`rotate(${balanceTilt}, 200, ${fulcrumY})`}>
                                <rect x="30" y={fulcrumY - 10} width="340" height="20" fill="#06B6D4" rx="5" ry="5" />
                                <circle cx="200" cy={fulcrumY} r="15" fill="#0891B2" />
                            </g>

                            {/* Corde del piatto sinistro */}
                            <line x1={rotatedBeamAttachL1.x} y1={rotatedBeamAttachL1.y} x2={rotatedBeamAttachL1.x} y2={newPlateBaseY + leftPanYOffset} stroke="#6B7280" stroke-width="2" />
                            <line x1={rotatedBeamAttachL2.x} y1={rotatedBeamAttachL2.y} x2={rotatedBeamAttachL2.x} y2={newPlateBaseY + leftPanYOffset} stroke="#6B7280" stroke-width="2" />

                            {/* Corde del piatto destro */}
                            <line x1={rotatedBeamAttachR1.x} y1={rotatedBeamAttachR1.y} x2={rotatedBeamAttachR1.x} y2={newPlateBaseY + rightPanYOffset} stroke="#6B7280" stroke-width="2" />
                            <line x1={rotatedBeamAttachR2.x} y1={rotatedBeamAttachR2.y} x2={rotatedBeamAttachR2.x} y2={newPlateBaseY + rightPanYOffset} stroke="#6B7280" stroke-width="2" />

                            {/* Piatto sinistro */}
                            <g transform={`translate(${leftPanXOffset + 50}, ${leftPanYOffset + newPlateBaseY})`}>
                                <g filter="url(#plateShadow)">
                                    <rect x="0" y="0" width="100" height="15" fill="url(#plateGradient)" rx="5" ry="5" />
                                    <rect x="5" y="15" width="90" height="50" fill="url(#plateGradient)" rx="5" ry="5" />
                                    <text x="50" y={15 + 30} textAnchor="middle" fill="#374151" fontSize="18" fontWeight="bold">{leftInput || '...'}</text>
                                </g>
                            </g>
                            {/* Piatto destro */}
                            <g transform={`translate(${rightPanXOffset + 250}, ${rightPanYOffset + newPlateBaseY})`}>
                                <g filter="url(#plateShadow)">
                                    <rect x="0" y="0" width="100" height="15" fill="url(#plateGradient)" rx="5" ry="5" />
                                    <rect x="5" y="15" width="90" height="50" fill="url(#plateGradient)" rx="5" ry="5" />
                                    <text x="50" y={15 + 30} textAnchor="middle" fill="#374151" fontSize="18" fontWeight="bold">{rightInput || '...'}</text>
                                </g>
                            </g>
                        </svg>
                    </div>
                    <div class="app-link-section">
                        <p><strong>Vuoi saperne di più sulla bilancia numerica?</strong></p>
                        <a href="paginabilancianumerica.html">&larr; Accedi alla Pagina Informativa sulla Bilancia Numerica</a>
                    </div>
                    <div class="back-link-section">
                        <p><strong>Torna alla Pagina Principale delle Bilance:</strong></p>
                        <a href="index.html">&larr; Torna alla Pagina Principale</a>
                    </div>
                    {/* Modal component for alerts */}
                    <Modal isOpen={isModalOpen} content={modalContent} onConfirm={handleModalConfirm} onCancel={handleModalCancel} inputRef={modalInputRef} />
                </div>
            )
        };
        window.onload = function() {
            if (window.ReactDOM) {
                window.ReactDOM.createRoot(document.getElementById('root')).render(<App/>)
            } else {
                console.error("ReactDOM non caricato correttamente. Controlla gli script CDN.")
            }
        };
    </script>
</body>
</html>
